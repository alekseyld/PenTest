String inString;

bool win = false;
bool process = false;
bool onStartKey = false;

int relePin = 11;
int keyPin = 6;

void setup() {
  pinMode(relePin, OUTPUT);
  pinMode(keyPin, INPUT);
  
  Serial.begin(9600);
}

void loop() {
  while (Serial.available() > 0 && !process) {
    int inChar = Serial.read();
    inString += (char)inChar; 
    if (inChar == '\n') {
       Serial.print("from: ");
       win = inString.equals("Player Win\n");
       Serial.println(inString);
       inString = ""; 
    }

    if (win) {
     digitalWrite(relePin, HIGH);
     win = false;
     process = true;
     onStartKey = digitalRead(keyPin) == HIGH;
     Serial.println("RELE ON");
   }
  }

  if (onStartKey) {
    onStartKey = digitalRead(keyPin) == HIGH;
  } else {
    if (process) {
      bool key = digitalRead(keyPin) == HIGH;
      //Serial.print("From key: ");
      //Serial.println(key);

      if (key) {
        delay(24500);
        digitalWrite(relePin, LOW);
        Serial.println("RELE OFF");
        process = false;
      }
    }  
  }
}
